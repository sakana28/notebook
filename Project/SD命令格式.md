---
date created: 2022-07-13 10:53
date updated: 2022-07-13 16:52
---

#SD

### 补充材料

[SD卡命令简介 - xxxdk's blog](http://xxxdk.xyz/xxx/2021/01/SD%E5%8D%A1%E5%91%BD%E4%BB%A4%E7%AE%80%E4%BB%8B/)

### 初始化:

SD 卡的初始化过程就是向 SD 中写入命令， 使其工作在预期的工作模式。在对 SD 卡进行读写操作时同样需要先发送写命令和读命令

### SD 卡的命令格式

由 6 个字节组成
![[Pasted image 20220713104935.png]]

#### Byte1 ：

命令字的第一个字节为命令号（如CMD0、CMD1等），格式为“01xxxxxx”。命令号的最高位始终为0，是命令号的起始位；次高位始终为1，是命令号的发送位；低6位为具体的命令号（如CMD55，8’d55=8’b0011_0111，命令号为01110111=0x77）。

#### Byte2~Byte5 ：

命令参数， 有些命令参数是保留位， 没有定义参数的内容， 保留位应设置为 0 。

#### Byte6 ：

前7位为CRC（[[循环冗余校验]]）校验位，最后一位为停止位**1**。
**注意** 此处比起原教程有修改，查询英语和教程后发现DI在接受相应时必须保持为1,因此停止位一定是1
见![[SPI Mode#^nb144v]]
SD卡在SPI模式下默认不开启CRC校验，在SDIO模式下开启CRC校验。也就是说在SPI模式下，CRC校验位必须要发，但是SD卡会在读到CRC校验位时自动忽略它，所以校验位全部设置为1即可。SD卡或MMC使用的是CRC-7/MMC模型.
CRC-7/MMC: x7+x3+1
width 7
poly 09
init 00
xorout 00
refin false
refout false
**需要注意的是**， SD 卡上电默认是 SDIO 模式， 在接收 SD 卡返回 CMD0 的响应命令时， 拉低片选 CS ， 进入 SPI 模式。 所以在发送 CMD0 命令的时 候， SD 卡处于 SDIO 模式， 需要开启 CRC 校验。
**另外** CMD8 (发送主机的电压范围以及查询 SD 卡支持的电压范围) 的 CRC 校验是始终启用的，也需要启用 CRC 校验。
除了这两个命令， 其它命令的 CRC 可以不用做校验。 SD 卡的命令分为标准命令（如 CMD0 ） 和应用相关命令（如 ACMD41 ） 。 ACMD 命令是特殊命令， 发送方法同标准命令一样，但是在发送应用相关命令之前，必须先发送 CMD55 命令， 告诉 SD 卡接下来的 命令是应用相关命令， 而非标准命令。
发送完命令后， SD 卡会返回响应命令的信息， 不同的 CMD 命令会 有不同类型的返回值， 常用的返回值有 R1 类型、 R3 类型和 R7 类型（ R7 类型是 CMD8 命令专用） 。

### SD 卡的常用命令说明

![[Pasted image 20220713105816.png]]
![[Pasted image 20220713105836.png]]

![[SD返回响应格式]]
#### 利用CMD8判断卡类型

对于 CMD8 无响应的情况， 可以发送 CMD55 + ACMD41 命令， 如果返回 0 ， 则表示 SD1.0 协议版本卡初始化成功， 如 果返回错误， 则确定为 MMC 卡； 在确定为 MMC 卡后， 继续向卡发送 CMD1 命令， 如果返回 0 ， 则 MMC 卡初始化成功， 否则判断为错误卡。
